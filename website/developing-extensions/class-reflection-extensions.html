<extends src="_layout_developing_extensions.html">
	<block name="title">Class Reflection Extensions</block>
	<block name="developing-extensions-content">
		<h1>Class Reflection Extensions</h1>

		<div md>
			Classes in PHP can expose "magic" properties and methods decided in run-time using class methods like `__get`, `__set`, and `__call`. Because PHPStan is all about static analysis (testing code for errors without running it), it has to know about those properties and methods beforehand.

			When PHPStan stumbles upon a property or a method that is unknown to built-in class reflection, it iterates over all registered class reflection extensions until it finds one that defines the property or method.

			Properties class reflection extensions
			---------------------

			To describe magic properties from `__get` and `__set` methods, an extension must implement the following interface:
		</div>

		<pre><code class="hljs lang-php">namespace PHPStan\Reflection;

interface PropertiesClassReflectionExtension
{

	public function hasProperty(ClassReflection $classReflection, string $propertyName): bool;

	public function getProperty(ClassReflection $classReflection, string $propertyName): PropertyReflection;

}</code></pre>

		<div md>
			Most likely you will also have to implement a new class implementing the `PropertyReflection` interface:
		</div>

		<pre><code class="hljs lang-php">namespace PHPStan\Reflection;

interface PropertyReflection
{

	public function getType(): Type;

	public function getDeclaringClass(): ClassReflection;

	public function isStatic(): bool;

	public function isPrivate(): bool;

	public function isPublic(): bool;

}</code></pre>

		<div md>This is how you register the extension in the [configuration file](/config-reference):</div>

		<pre><code class="hljs lang-yaml">services:
	-
		class: App\PHPStan\PropertiesFromAnnotationsClassReflectionExtension
		tags:
			- phpstan.broker.propertiesClassReflectionExtension</code></pre>

		<div md>
			Methods class reflection extensions
			---------------------

			To describe magic methods from the `__call` method, an extension must implement the following interface:
		</div>

		<pre><code class="hljs lang-php">namespace PHPStan\Reflection;

interface MethodsClassReflectionExtension
{

	public function hasMethod(ClassReflection $classReflection, string $methodName): bool;

	public function getMethod(ClassReflection $classReflection, string $methodName): MethodReflection;

}</code></pre>

		<div md>
			Most likely you will also have to implement a new class implementing the `MethodReflection` interface:
		</div>

		<pre><code class="hljs lang-php">namespace PHPStan\Reflection;

interface MethodReflection
{

	public function getDeclaringClass(): ClassReflection;

	public function getPrototype(): self;

	public function isStatic(): bool;

	public function isPrivate(): bool;

	public function isPublic(): bool;

	public function getName(): string;

	/**
	 * @return \PHPStan\Reflection\ParameterReflection[]
	 */
	public function getParameters(): array;

	public function isVariadic(): bool;

	public function getReturnType(): Type;

}</code></pre>

		<div md>This is how you register the extension in the [configuration file](/config-reference):</div>

		<pre><code class="hljs lang-yaml">services:
	-
		class: App\PHPStan\EnumMethodsClassReflectionExtension
		tags:
			- phpstan.broker.methodsClassReflectionExtension
</code></pre>
	</block>
</extends>
